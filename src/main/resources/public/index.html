<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
    <meta charset="UTF-8">
    <title>kotlin-blog</title>
    <!--依赖 st-->
    <link rel="stylesheet" href="css/jquery.mobile-1.4.5.css">
    <link rel="stylesheet" href="css/layer.css">
    <script src="js/jquery.js"></script>
    <script src="js/jquery.mobile-1.4.5.js"></script>
    <script src="js/layer.js"></script>
    <!--依赖 ed-->
</head>

<body>
<!--home-->
<div data-role="page" id="home">

    <div data-role="header" data-position="fixed">
        <h1>欢迎来到我的主页</h1>
    </div>

    <div data-role="main" class="ui-content">
        <p>我现在是一个移动端开发者!!</p>
        <a href="#admin">我的</a>
    </div>

    <div data-role="footer" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li>
                    <a href="#home" data-icon="home" class="ui-btn-active">主页</a>
                </li>
                <li>
                    <a href="#" data-icon="plus">我的</a>
                </li>
                <li>
                    <a href="#admin" data-icon="user">我的</a>
                </li>
            </ul>
        </div>
    </div>
</div>

<!--admin-->
<div data-role="page" id="admin">

    <div data-role="header" data-position="fixed">
        <h1>我的</h1>
        <a href="#" data-role="button" data-icon="gear" class="ui-btn-right">设置</a>
    </div>

    <div data-role="main" class="ui-content">
        <ul data-role="listview" data-inset="true" id="userInfo">
            <li style="display: none">
                <h4 name="nickname">昵称</h4>
            </li>
            <li style="display: none">
                <div class="ui-grid-b">
                    <div class="ui-block-a">
                        <a href="#" data-role="button"><span>25</span><br/>文章</a>
                    </div>
                    <div class="ui-block-b">
                        <a href="#" data-role="button"><span>25</span><br/>关注</a>
                    </div>
                    <div class="ui-block-c">
                        <a href="#" data-role="button"><span>25</span><br/>粉丝</a>
                    </div>
                </div>
            </li>
            <li style="display: none">
                <a data-role="button" onclick="logout()">登出</a>
            </li>
            <li style="display: none">
                <a href="#login" data-role="button">点击登录帐号<br/>立即开始体验属于你的创作</a>
            </li>
        </ul>
        <ul data-role="listview" data-inset="true">
            <li>
                <a href="#">收件箱<span class="ui-li-count">25</span></a>
            </li>
            <li>
                <a href="#">发件箱<span class="ui-li-count">432</span></a>
            </li>
            <li>
                <a href="#">垃圾箱<span class="ui-li-count">7</span></a>
            </li>
        </ul>
    </div>

    <div data-role="footer" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li>
                    <a href="#home" data-icon="home">主页</a>
                </li>
                <li>
                    <a href="#admin" data-icon="user" class="ui-btn-active">我的</a>
                </li>
            </ul>
        </div>
    </div>
</div>

<!--login-->
<div data-role="page" id="login">

    <div data-role="header" data-position="fixed">
        <h1>登陆到kotlin-blog</h1>
    </div>

    <div data-role="main" class="ui-content">
        <form method="post" action="/admin/login" id="loginForm">
            <div class="ui-field-contain">
                <label for="username">帐号:</label>
                <input type="text" name="username" id="username">

                <label for="password">密码:</label>
                <input type="password" name="password" id="password">
            </div>
            <input type="button" data-inline="true" value="提交" onclick="onLogin()">
        </form>
    </div>

    <div data-role="footer" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li>
                    <a href="#home" data-icon="home" class="ui-btn-active">主页</a>
                </li>
                <li>
                    <a href="#admin" data-icon="user">我的</a>
                </li>
            </ul>
        </div>
    </div>
</div>
<!--script-->
<script>
    var userInfo = $("#userInfo");
    var getUserInfo = ()=> {
        $.get("/user/me", (apiResult) => {
            if (apiResult.status == 404) {
                userInfo.children("li:eq(3)").show();
                userInfo.children("li:lt(3)").hide();
            } else if (apiResult.status == 200) {
                userInfo.children("li:eq(3)").hide();
                userInfo.children("li:lt(3)").show();
                userInfo.children("li:eq(0)").children("[name=nickname]").text(apiResult.content.nickname);
            }
        });
    };
    var logout = ()=>{
        $.get("/admin/logout",(apiResult)=>{
            if(apiResult.status == 200)
                getUserInfo();
        });
    };
    var onLogin = () => {
        $.post("/admin/login", $("#loginForm").serialize(), (apiResult) => {
            layer.open({
                content:apiResult.message
            });
            if (apiResult.status == 404) {
                $("#loginForm")[0].reset();
            }else if(apiResult.status == 200){
                window.location.href="#admin";
                getUserInfo();
            }
        });
    }
    $(()=>{
        getUserInfo();
    });
</script>
</body>

</html>